{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h2>Transactions</h2>
</div>

<div class="transaction-controls">
    <form method="GET" action="{{ url_for('transactions') }}" class="form-inline">
        <div class="form-group">
            <label for="account_id">Select Account:</label>
            <select id="account_id" name="account_id" onchange="this.form.submit()">
                <option value="">-- Select Account --</option>
                {% for account in accounts %}
                <option value="{{ account.id }}" {% if account.id|string == selected_account %}selected{% endif %}>
                    {{ account.account_number }} ({{ account.account_type }})
                </option>
                {% endfor %}
            </select>
        </div>
    </form>

    {% if selected_account %}
    <button onclick="document.getElementById('transactionModal').style.display='block'" class="btn btn-primary">
        New Transaction
    </button>
    {% endif %}
</div>

{% if transactions %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.transaction_date.strftime('%Y-%m-%d %H:%M') }}</td>
                <td class="{% if transaction.transaction_type == 'deposit' %}text-success{% else %}text-danger{% endif %}">
                    {{ transaction.transaction_type|title }}
                </td>
                <td>${{ "%.2f"|format(transaction.amount) }}</td>
                <td>{{ transaction.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% elif selected_account %}
    <p>No transactions found for this account.</p>
{% else %}
    <p>Please select an account to view transactions.</p>
{% endif %}

<!-- Transaction Modal -->
<div id="transactionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('transactionModal').style.display='none'">&times;</span>
        <h3>New Transaction</h3>
        <form method="POST" action="{{ url_for('perform_transaction') }}">
            <input type="hidden" name="account_id" value="{{ selected_account }}">
            
            <div class="form-group">
                <label for="transaction_type">Transaction Type:</label>
                <select id="transaction_type" name="transaction_type" required>
                    <option value="deposit">Deposit</option>
                    <option value="withdraw">Withdraw</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="amount">Amount:</label>
                <input type="number" id="amount" name="amount" step="0.01" min="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description (optional):</label>
                <textarea id="description" name="description" rows="2"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary">Submit Transaction</button>
        </form>
    </div>
</div>
{% endblock %}